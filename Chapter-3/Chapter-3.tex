\chapter{A Spatial Model for Rare Binary Events}
\label{chap:three}
\section{Introduction}\label{rbs:intro}

The goal in binary regression is to relate a latent variable to a response using a link function.
% $g$ so that P$(Y_i=1) = \pi_i= g(\bX_i \bbeta)$, where $\bX_i$ is the vector of covariates for observation $i$, and $\bbeta$ is the $p$-vector of regression coefficients.
Two common examples of binary regression include logistic regression
% with $\pi_i = \frac{ \exp{\bX_i \bbeta} }{1 + \exp{\bX_i \bbeta}}$
and probit regression \citep{Agresti2003}.
% with $\pi_i = \Phi(\bX_i \bbeta)$ where $\Phi(\cdot)$ represents the standard normal distribution function.
The link functions for logistic and probit regression are symmetric, so they may not be well-suited for binary data with very few ones.
% In the case that $\xi = 0$, this is the complementary log-log (cloglog) link function.
An asymmetric alternative to these link functions is the complementary log-log (cloglog) link function.
More recently, \citet{Wang2010} introduced the generalized extreme value (GEV) link function for rare binary data (a review is given in \aref{rba:rarebinary}).
The GEV link function introduces a new shape parameter to the link function that controls the degree of asymmetry.
The cloglog link is a special case of the GEV link function when the shape parameter is 0.
Although this link was selected due to its ability to handle asymmetry, the GEV distribution is one of the primary distributions used for modeling extremes \citep{Coles2001}.
Because extreme events are rare, it is therefore reasonable to use similar methods when analyzing rare binary data.
% where

Most popular methods for spatial binary data propose a latent continuous spatial process with the binary response determined by whether the latent process exceeds a threshold \citep{DeOliveira2000,Diggle2007}.
In the hierarchical framework, spatial dependence is typically modeled with an underlying latent Gaussian process, and conditioned on this process, observations are independent.
For large datasets, low-rank models can be used to ease the computational burden \citep{Finley2015}.
A Gaussian process is not appropriate for modeling extremal dependence in a distribution because there is no asymptotic dependence except in the case of perfect dependence.
This lack of asymptotic dependence leads to an underestimation of probability that two observations will jointly exceed a high threshold.

We propose using a latent max-stable process \citep{deHaan1984} because it allows for asymptotic dependence.
The max-stable process arises as the limit of the location-wise maximum of infinitely many spatial processes.
Max-stable processes are extremely flexible, but are often challenging to work with in high dimensions \citep{Wadsworth2014,Thibaud2013a}.
To address this challenge, methods have been proposed that implement composite likelihood techniques for max-stable processes \citep{Padoan2010,Genton2011,Huser2014}.
Composite likelihoods have been used to model binary spatial data \citep{Heagerty1998}, but this is not using max-stable processes.
As an alternative to these composite approaches, \citet{Reich2012} present a hierarchical model that implements a low-rank representation for a max-stable process.
We chose to use this low-rank representation for our rare binary spatial regression model.

\hl{Paragraph outlining the structure of the paper}

\section{Spatial dependence for binary regression} \label{rbs:maxstab}
Let $Y(\bs)$ be the binary response at spatial location $\bs$ in a spatial domain of interest $\calD \in \calR^2$.
We assume $Y(\bs) = I[Z(\bs) > 0]$ where $Z(\bs)$ is a latent continuous max-stable process.
The marginal distribution of $Z(\bs)$ at site $\bs$ is GEV with location $\bX(\bs)^\top \bbeta$, scale $\sigma > 0$, and shape $\xi$, where $\bX(\bs)$ is a $p$-vector of spatial covariates at site $\bs$ and $\bbeta$ is a $p$-vector of regression coefficients.
We set $\sigma = 1$ for identifiability because only the sign and not the scale of $Z$ affects $Y$.
If $\bX(\bs)^\top \bbeta = \mu$ for all $\bs$, then P$(Y = 1)$ is the same for all observations, and the two parameters $\mu$ and $\xi$ are not individually identifiable, so when there are no covariates, we fix $\xi = 0$.
Although $\bbeta$ and $\xi$ could be permitted to vary across space, we assume that they are constant across $\calD$.
At spatial location $\bs$, the marginal distribution (over $Z(\bs)$) is \mbox{$P[Y(\bs) = 1] = 1 - \exp\left[ -\displaystyle\frac{ 1 }{ z(\bs)} \right]$} where $z(\bs) = \left[1 - \xi \bX(\bs)^\top \bbeta\right]^{1 / \xi}$.
This is the same as the marginal distribution given by \citet{Wang2010}.

For a finite collection of locations $\bs_1, \ldots, \bs_n,$ denote the vector of observations $\bY = [Y(\bs_1), \ldots, Y(\bs_n)]^T$.
The spatial dependence of $\bY$ is determined by the joint distribution of $\bZ = [Z(\bs_1),\ldots, Z(\bs_n)]^T$.
To incorporate spatial dependence, we consider the hierarchical representation of the max-stable process proposed in \citet{Reich2012}.
Consider a set of positive stable random effect $A_1, \ldots, A_L \iid \text{PS}(\alpha)$ associated with spatial knots $\bv_1, \ldots, \bv_L \in \calR^2$.
The hierarchical model is given by
\begin{align} \label{rbeq:hiermodel}
  \bZ(\bs_i) | A_1, \ldots, A_L \indep \text{GEV}[\bX(\bs_i)^\top \bbeta + \theta(\bs_i), \alpha \theta(\bs_i), \xi \alpha] \quad \text{and} \quad \theta(\bs_i) = \left[\sum_{l = 1}^L A_l w_l (\bs_i)^{1 / \alpha} \right]^\alpha
\end{align}
where $w_{l}(\bs_i) > 0$ are a set of $L$ weights that vary smoothly across space and satisfy $\displaystyle \sum_{l = 1}^L w_l(\bs) = 1$ for all $\bs$, and $\alpha\in(0,1)$ determines the strength of dependence, with $\alpha$ near zero giving strong dependence and $\alpha=1$ giving joint independence.

Because the latent $\bZ(\bs)$ are independent given the random effects $\theta(\bs)$, the binary responses are also conditionally independent.
This leads to the tractable likelihood
\begin{align} \label{rbeq:condlike}
  Y(\bs_i) | A_l, \ldots, A_L &\indep \text{Bern}[\pi(\bs_i)]
\end{align}
where
\begin{align} \label{rbeq:pyeq1cond}
  \pi(\bs_i) &= 1 - \exp \left\{ -\displaystyle \sum_{ l = 1 }^{L} A_l \left( \frac{ w_{l}(\bs_i) }{ z(\bs_i) } \right)^{ 1/\alpha} \right\}.
\end{align}
Marginally over the $A_l$, this gives
\begin{align}
  Z(\bs) \sim \text{GEV}(\bX(\bs)^\top \bbeta, 1, \xi),
\end{align}
and thus P$[Y(\bs) = 1] = 1 - \exp\left\{-\displaystyle \frac{1}{z(\bs)}\right\}$ where $z(\bs) = \left[1 - \xi \bX(\bs) \bbeta\right]^{1 / \xi}$.

Many weight functions are possible, but the weights must be constrained so that $\displaystyle \sum_{l=1}^L w_{l}(\bs_i)=1$ for $i=1,\ldots,n$ to preserve the marginal GEV distribution.
For example, \cite{Reich2012} take the weights to be scaled Gaussian kernels with knots $\bv_l$,
\begin{align}\label{rbeq:w}
   w_{l}(\bs_i) = \frac{\exp\left[-0.5\left(||\bs_i-\bv_l||/\rho\right)^2\right]}
                 {\sum_{j=1}^L\exp\left[-0.5\left(||\bs_i-\bv_j||/\rho\right)^2\right]}
\end{align}
where $||\bs_i - \bv_l||$ is the distance between site $\bs_i$ and knot $\bv_l$, and the kernel bandwidth $\rho>0$ determines the spatial range of the dependence, with large $\rho$ giving long-range dependence and vice versa.

After marginalizing out the positive stable random effects, the joint distribution of $\bZ$ is
\begin{align}\label{rbeq:jointCDF}
  G(\bz) = P\left[Z(\bs_1) < z(\bs_1), \ldots, Z(\bs_n) < z(\bs_n)\right] = \exp\left\{-\sum_{l=1}^L\left[\sum_{i=1}^n\left(\frac{w_{l}(\bs_i)}{z(\bs_i)}\right)^{1/\alpha}\right]^{\alpha}\right\},
\end{align}
where $G(\cdot)$ is the CDF of a multivariate GEV distribution.
This is a special case of the multivariate GEV distribution with asymmetric Laplace dependence function \citep{Tawn1990}.

% In the case that $n$ is large, low-rank predictive process models can be used to ease the computation.

% \subsubsection{Weight functions}\label{rbs:weights}

\section{Joint distribution}\label{rbs:multivariate}
We give an exact expression in the case where there are only two spatial locations which is useful for constructing a pairwise composite likelihood \citep{Padoan2010} and studying spatial dependence.
When $n = 2$, the probability mass function is given by
\begin{align} \label{rbeq:biv}
  \text{P}[Y(\bs_i) = y_i, Y(\bs_j) = y_j] = \left\{ \begin{array}{ll}
    \varphi(\bz) &y_i = 0, y_j = 0\\
    \exp\left\{ - \displaystyle \frac{ 1 }{ z(\bs_i) } \right\} - \varphi(\bz), &y_i = 1, y_j = 0 \\
    \exp\left\{ - \displaystyle \frac{ 1 }{ z(\bs_j) } \right\} - \varphi(\bz), &y_i = 0, y_j = 1 \\
    1 - \exp\left\{ - \displaystyle\frac{ 1 }{ z(\bs_i) } \right\} - \exp \left\{ -\displaystyle \frac{ 1 }{z(\bs_j)} \right\} + \varphi(\bz), \quad &y_i = 1, y_j = 1
  \end{array} \right.
\end{align}
where $\varphi(\bz) = \exp \left\{ - \displaystyle \sum_{ l = 1 }^{ L } \left[ \left( \displaystyle \frac{ w_{ l }(\bs_i) }{ z(\bs_i) } \right)^{1/\alpha} + \left( \displaystyle \frac{ w_{l }(\bs_j)}{z(\bs_j)} \right)^{1/\alpha} \right]^{\alpha} \right\}$.
For more than two locations, we are also able to compute the exact likelihood when the $n$ is large but the number of events $K = \displaystyle \sum_{i = 1}^n Y(\bs_i)$ is small, as might be expected for very rare events, see \aref{rba:likelihoodderivation}.

 % - Assume Z1 and Z2 are both GEV(\beta,1,1) so that the probability of Yi=1 decreases to zero as beta increases
 % - A common measure of dependence between binary variables is Cohen’s Kappa, K(beta) =
 % - For the spatial model we get K(beta)=
 % - To measure extremal dependence let beta go to infinity so that event are increasing more rare
 % - K = limK(beta) = …
 % - This is similar to the extremal coefficient in Reich and Shaby

\section{Quantifying spatial dependence} \label{rbs:spatdep}
Assume that $Z_1$ and $Z_2$ are both GEV$(\beta, 1, 1)$ so that P$(Y_i = 1)$ decreases to zero as $\beta$ increases.
A common measure of dependence between binary variables is Cohen's Kappa \citep{Cohen1960},
\begin{align}
  \kappa(\beta) = \frac{P_A - P_E}{1 - P_E}
\end{align}
where $P_A$ is the joint probability of agreement $P(Y_1 = Y_2)$ and $P_E$ is the joint probability of agreement under an assumption of independence $P(Y_i = 1)^2 + P(Y_i = 0)^2$.
For the spatial model,
\begin{align*}
  P_A(\beta) &= 1 - 2 \exp\left\{ -\frac{1}{\beta} \right\} + 2 \exp\left\{-\frac{\vartheta(\bs_1, \bs_2)}{\beta}  \right\} \nonumber \\
  P_E(\beta) &= 1 - 2 \exp \left\{ -\frac{1}{\beta} \right\} + 2 \exp \left\{ -\frac{2}{\beta} \right\}, \nonumber
\end{align*}
and
\begin{align} \label{rbeq:kappa}
  \kappa(\beta) &= \frac{P_A(\beta) - P_E(\beta)}{1 - P_E(\beta)} = \frac{\exp\left\{-\frac{\vartheta(\bs_1, \bs_2) - 1}{\beta}  \right\} - \exp \left\{ -\frac{1}{\beta} \right\}}{1 - \exp \left\{ -\frac{1}{\beta} \right\}}
\end{align}
where $\vartheta (\bs_i, \bs_j) = \sum_{ l = 1 }^{ L } \left[ w_{l}(\bs_i)^{ 1/\alpha } +  w_{ l}(\bs_j)^{ 1/\alpha } \right]^\alpha$ is the pairwise extremal coefficient given by \citet{Reich2012}.
To measure extremal dependence, let $\beta \rightarrow \infty$ so that events are increasingly rare.
Then,
\begin{align}
  \kappa = \lim_{\beta \rightarrow \infty} \kappa(\beta) = 2 - \vartheta(\bs_1, \bs_2)
\end{align}
which is the same as the $\chi$ statistic of \citet{Coles2001}, a commonly used measure of extremal dependence.

\section{Computation}\label{rbs:comp}
For small $K$, we can evaluate the likelihood directly.
When $K$ is large, we use Markov chain Monte Carlo (MCMC) methods with the random effects model to explore the posterior distribution.
To overcome challenges with evaluating the positive stable density, we follow \citet{Reich2012} and introduce a set of auxiliary variables $B_1, \ldots, B_L$ following the auxiliary variable technique of \citet{Stephenson2009} (for more details, see Appendix A.3 of \citet{Reich2012}).
So, the hierarchical model is given by
\begin{align}
  Y(\bs_i) | \pi(\bs_i) &\indep \text{Bern}[\pi(\bs_i)] \\
    \pi(\bs_i) &= 1 - \exp \left\{ -\displaystyle \sum_{ l = 1 }^{L} A_l \left( \frac{ w_{l}(\bs_i) }{ z(\bs_i) } \right)^{ 1/\alpha} \right\} \nonumber\\
    % Z(\bs_i) | A_l, \ldots, A_L &\indep \text{GEV}[\bX(\bs_i)^\top \bbeta + \theta(\bs_i), \alpha \theta(\bs_i), \xi \alpha] \nonumber\\
    A_l &\sim \text{PS}(\alpha) \nonumber
\end{align}
with priors $\bbeta \sim \text{N}(\bZero, \sigma^2_\beta \bI_p )$, $\xi \sim \text{N}(0, \sigma^2_\xi)$, $\rho \sim \text{Unif}(\rho_l, \rho_u)$, and $\alpha \sim \text{Beta}(a_\alpha, b_\alpha)$.
The model parameters are updated using Metropolis Hastings (MH) update steps, and the random effects $A_1, \ldots, A_L$, and auxiliary variables $B_1, \ldots, B_L$ are updated using Hamiltonian Monte Carlo (HMC) update steps.
The code for this is available online through \texttt{https://github.com/sammorris81/rare-binary}.

\section{Simulation study}\label{rbs:sim}

For our simulation study, we generate $n_m = 50$ datasets under 12 different simulation settings to explore the impact of sample size, sampling technique, and misspecification of link function.
We generate data assuming three possible types of underlying process.
For each of the underlying processes, we generate complete datasets on a $100 \times 100$ rectangular grid of $n = 10,000$ locations.
If a dataset is generated with $K < 100$ or $K > 700$, it is discarded and a new dataset is generated.
For model fitting, we select a subsample and use the remaining sites to evaluate predictive performance.

\subsection{Latent processes} \label{rbs:simsettings}
The first process is a latent max-stable process that uses the GEV link described in \eref{rbeq:hiermodel} with knots on a $50 \times 50$ regularly spaced grid on $[0, 1] \times [0, 1]$.
For this process, we set $\alpha = 0.35$, $\rho = 0.1$, and $\beta_0 \approx 2.97$ which gives $K = 500$, on average.
Because there are no covariates, we set $\xi = 0$.
We then set $Y(\bs) = I[Z(\bs) > 0]$.

For the second process, we generate a latent variable from a spatial Gaussian process with a mean of $\text{logit}(0.05) \approx -2.94$ and an exponential covariance given by
\begin{align}
  \text{cov}(\bs_1, \bs_2) = \tau_\text{Gau}^2 \exp\left\{- \frac{||\bs_1 - \bs_2||}{\rho_\text{Gau}}\right\}
\end{align}
where $\tau_\text{Gau} = 10$ and $\rho_\text{Gau} = 0.1$.
Finally, we generate $Y(\bs_i) \ind \text{Bern}[\pi(\bs_i)]$
where $\pi(\bs_i) = \displaystyle \frac{ \exp\{z(\bs)\}}{1 + \exp\{z(\bs)\} }$

For the third process, we generate data using a hotspot method.
For this process, we first generate hotspots throughout the space.
Let $n_\text{hs}$ be the number of hotspots in the space.
Then $n_\text{hs} - 1 \sim$ Poisson$(2)$.
This generation scheme ensures that every dataset has at least one hotspot.
We generate the hotspot locations $\bh_1, \ldots, \bh_{n_\text{hs}} \sim$ Unif$(0, 1)^2$.
Let $B_h$ be a circle of radius of radius $r_h$ around hotspot $h = 1, \ldots, n_\text{hs}$.
The $r_h$ differ for each hotspot and are generated i.i.d. from a Unif$(0.03, 0.08)$ distribution.
We set P$[Y(\bs_i) = 1] = 0.85$ for all $\bs_i$ in $B_h$, and P$[Y(\bs_i)] = 0.0005$ for all $\bs_i$ outside of $B_h$.
These settings are selected to give an average of approximately $K = 500$ for the datasets.
\fref{rbfig:simulateddata} gives an example dataset from each of the data settings.

\begin{figure}
  \centering
  \includegraphics[width=\linewidth, trim=0 1in 0 1in]{plots/simulateddata}
  \caption{One simulated dataset from spatial GEV (left), spatial logistic (center), and hotspot (right).}
  \label{rbfig:simulateddata}
\end{figure}

\subsection{Methods} \label{rbs:methods}
For each dataset, we fit the model using three different models, the proposed spatial GEV model, a spatial probit model, and a spatial logistic model.
Logistic and probit methods represent two of the more common spatial techniques for binary data, we chose to compare our method to them.
One way these methods differ from our proposed method is that they assume the underlying process is Gaussian.
In this case, we assume that $Z(\bs)$ follows a Gaussian process with mean $\bX(s)^\top \bbeta$.
The marginal distributions are given by
\begin{align}
  P\left[Y(\bs) = 1\right] = \left\{ \begin{array}{ll}
    \displaystyle \frac{\exp\left[\bX^\top(\bs) \bbeta + \bW (\bs) \bepsilon \right]}{1 + \exp\left[\bX^\top(\bs) \bbeta + \bW (\bs) \bepsilon \right]}, \qquad &\text{logistic}\\
    \Phi\left[\bX^\top \bbeta (\bs) + \bW (\bs) \bepsilon \right], \qquad &\text{probit}
  \end{array}\right.
\end{align}
where $\bepsilon \sim$ N$(\bZero, \tau^2_L \bI_L)$ are Gaussian random effects at the knot locations, and $\bW(\bs)$ are a set of $L$ basis functions given to recreate the Gaussian process at all sites.
We use our own code for the spatial probit model, but we use the \texttt{spGLM} function in the \texttt{spBayes} package \citep{Finley2015} to fit the spatial logistic model.
For the probit model, we use
\begin{align}
  \bW_l(\bs_i) = \frac{\exp\left[-\left(||\bs_i-\bv_l||/\rho\right)^2\right]}
                 {\sqrt{\displaystyle \sum_{j=1}^L\exp\left[-\left(||\bs_i-\bv_j||/\rho\right)^2\right]^2}}.
\end{align}
For the logistic model, the $\bW_l(\bs_i)$ are the default implementation from the \texttt{spGLM}.
\hl{Timings}

\subsection{Sampling technique} \label{rbs:simsampling}
We subsample the generated data using $n_s = 100, 250$ initial locations for two different sampling designs.
The first is a two-stage spatially-adaptive cluster technique (CLU) taken from \citet{Pacifici2016}.
In this design, if an initial location is occupied, we also include the four rook neighbor (north, east, south, and west) sites in the sample.
For the second design, we use a simple random sample (SRS) with the same number of sites included in the cluster sample.
For the GEV setting, when $n_s = 100$, there are on average $117$ sites and at most $142$ sites in a sample, and when $n_s = 250$, there are on average $286$ sites and at most $332$ sites in a sample.
For the logistic setting, when $n_s = 100$, there are on average $118$ sites and at most $147$ sites in a sample, and when $n_s = 250$, there are on average $290$ sites and at most $330$ sites in a sample.
For the hotspot setting, when $n_s = 100$, there are on average $110$ sites and at most $128$ sites in a sample, and when $n_s = 250$, there are on average $275$ sites and at most $306$ sites in a sample.

\subsection{Priors} \label{rbs:simpriors}
For all models, we only include an intercept term $\beta_0$ in the model, and the prior for the intercept is \mbox{$\beta_0 \sim$ N$(0, 10)$}.
Additionally, for all models, the prior for the bandwidth is $\rho \sim$ Unif$(0.001, 1)$.
This lower bound is selected because it is half of the distance between the rook neighbors of the knots.
For the GEV method, the prior for the spatial dependence parameter is $\alpha \sim$ Beta$(2, 5)$.
We select this prior because it gives greater weight to $\alpha < 0.5$, which is the point at which spatial dependence becomes fairly week, but also avoids values below 0.1 which can lead to numerical problems.
We fix $\xi = 0$ because we do not include any covariates.
For both the spatial probit and logistic models, the prior on the variance term for the random effects is IG$(0.1, 0.1)$ where IG$(\cdot)$ is an Inverse Gamma distribution.
For all models, we run the MCMC sampler for 25,000 iterations with a burn-in period of 20,000 iterations.
Convergence is assessed through visual inspection of traceplots.

\subsection{Model comparisons}\label{rbs:cv}
For each dataset, we fit the model using the $n_s$ observations as a training set, and validate the model's predictive power at the remaining grid points.
Let $\bs^*_j$ be the $j$th site in the validation set.
To obtain the posterior predictive distribution, at each iteration of the MCMC, we generate a spatial field of zeros and ones at the validation locations.
\hl{I plan to update this if we have time to rerun the computing. At the moment, I'm trying to get new results for EBF because of the error I found.}
Then to obtain $\hat{P}[Y(\bs^*_j) = 1]$, we take the average of the posterior distribution for each $j$.
We consider a few different metrics for comparing model performance.
One score is the Brier scores \citep[BS]{Gneiting2007}.
The Brier score for predicting an occurrence at site $\bs$ is given by $\{I[Y(\bs)=1] - \hat{P}[Y(\bs)=1]\}^2$ where $I[Y(\bs) = 1]$ is an indicator function indicating that an event occurred at site $\bs$.
We average the Brier scores over all test sites, and a lower score indicates a better fit.
We also consider the receiver operating characteristic (ROC) curve, and the area under the ROC curve (AUROC) for the different methods and settings.
The ROC curve and AUROC are obtained via the \texttt{ROCR} \citep{Sing2005} package in \texttt{R} \citep{Rmanual}.
We then average AUCs across all datasets for each method and setting to obtain a single AUC for each combination of method and setting.

\subsection{Results} \label{rbs:simresults}
\hl{Needs updating}

\tref{rbtbl:simbsresults} gives the Brier scores and AUC for each of the methods.
In \fref{rbfig:simrocgev} -- \fref{rbfig:simrochot}, for each setting we present the vertically averaged ROC curve for each simulation method.

\begin{table}
  \caption{Brier scores ($\times 100$) [SE] and AUROC [SE] for GEV, Probit, and Logistic methods from the simulation study.}
  \label{rbtbl:simbsresults}
  \centering
  \scriptsize
  \begin{tabular}{ccclllclll}
  \toprule
    \multicolumn{3}{c}{ }& \multicolumn{3}{c}{BS} & \phantom{abc} & \multicolumn{3}{c}{AUROC}\\
    \cmidrule{4-6} \cmidrule{8-10}
    \multicolumn{1}{c}{Setting} & \multicolumn{1}{c}{$n$} & \multicolumn{1}{c}{Sample Type} & \multicolumn{1}{c}{GEV}    & \multicolumn{1}{c}{Probit} & \multicolumn{1}{c}{Logistic} & \phantom{abc} & \multicolumn{1}{c}{GEV}    & \multicolumn{1}{c}{Probit} & \multicolumn{1}{c}{Logistic} \\
  \midrule
  GEV & 100 & CLU & 3.10 [0.27] & 2.45 [0.19] & 2.79 [0.25] && 0.926 [0.009] &
      0.942 [0.009] & 0.900 [0.020]\\
      &     & SRS & 2.92 [0.20] & 2.54 [0.18] & 2.92 [0.25] && 0.938 [0.007] & 0.951 [0.007] & 0.879 [0.021]\\
      & 250 & CLU & 2.14 [0.14] & 1.84 [0.12] & 2.02 [0.14] && 0.955 [0.006] & 0.954 [0.010] & 0.929 [0.016]\\
      &     & SRS & 2.32 [0.15] & 2.09 [0.14] & 2.28 [0.15] && 0.948 [0.009] & 0.948 [0.010] & 0.906 [0.020]\\
  \midrule
  Logistic & 100 & CLU & 5.29 [0.25] & 4.94 [0.23] & 5.10 [0.25] && 0.659 [0.012]
           & 0.676 [0.014] & 0.643 [0.013]\\
           &     & SRS & 5.32 [0.23] & 5.09 [0.24] & 5.34 [0.26] && 0.690 [0.012] & 0.693 [0.012] & 0.613 [0.012]\\
           & 250 & CLU & 4.81 [0.21] & 4.55 [0.21] & 4.66 [0.22] && 0.731 [0.010] & 0.749 [0.010] & 0.714 [0.014]\\
           &     & SRS & 4.81 [0.23] & 4.56 [0.21] & 4.95 [0.24] && 0.744 [0.011] & 0.764 [0.010] & 0.702 [0.015]\\
  \midrule
  Hotspot & 100 & CLU & 2.29 [0.17] & 2.01 [0.15] & 1.81 [0.12] && 0.841 [0.016] &        0.833 [0.019] & 0.824 [0.020]\\
          &     & SRS & 2.09 [0.13] & 1.87 [0.12] & 2.13 [0.15] && 0.885 [0.015] &  0.906 [0.013] & 0.844 [0.015]\\
          & 250 & CLU & 1.65 [0.11] & 1.25 [0.08] & 1.40 [0.09] && 0.934 [0.009] &  0.949 [0.008] & 0.939 [0.011]\\
          &     & SRS & 1.53 [0.10] & 1.31 [0.08] & 1.63 [0.11] && 0.947 [0.007] &  0.960 [0.005] & 0.918 [0.015]\\
  \bottomrule
  \end{tabular}
\end{table}

\begin{figure}
  % code/analysis/simstudy/combine-tables.R
  \includegraphics[width=\linewidth]{plots/sim-perf-gev}
  \caption{Vertically averaged ROC curves for GEV simulation setting.}
  \label{rbfig:simrocgev}
\end{figure}

\begin{figure}
  % code/analysis/simstudy/combine-tables.R
  \includegraphics[width=\linewidth]{plots/sim-perf-probit}
  \caption{Vertically averaged ROC curves for probit simulation setting.}
  \label{rbfig:simrocpro}
\end{figure}

\begin{figure}
  % code/analysis/simstudy/combine-tables.R
  \includegraphics[width=\linewidth]{plots/sim-perf-hotspot}
  \caption{Vertically averaged ROC curves for hotpost simulation setting.}
  \label{rbfig:simrochot}
\end{figure}

% \begin{table}
%   \caption{Relative AUC for GEV and Probit methods}
%   \label{rbtbl:simaucresults}
%   \centering
%   \begin{tabular}{r|lll}
%     \cline{2-4}
%               & GEV    & Probit & Logit\\
%     \hline
%     Setting 1 & 0.8998 & 0.8973 & 0.8897\\
%     Setting 2 & 0.9458 & 0.9399 & 0.9356\\
%     Setting 3 & 0.7288 & 0.7371 & 0.7157\\
%     Setting 4 & 0.7906 & 0.8056 & 0.8115\\
%     Setting 5 & 0.8426 & 0.8458 & 0.8388\\
%     Setting 6 & 0.8756 & 0.8686 & 0.8765\\
%     \hline
%   \end{tabular}
% \end{table}

% We analyzed the results for this simulation study using a Friedman test at $\alpha = 0.05$ to see if at least one method had a significantly different Brier score or AUC.
% For any setting that yielded a significant p-value, we conducted a Wilcoxon-Nemenyi-McDonald-Thompson test to see which of the methods had different results.
% The full results for the Wilcoxon-Nemenyi-McDonald-Thompson tests are given in \aref{rba:pdiffs}.
% For all settings, we find significant results for the Friedman test comparing the Brier scores for the methods.
% Specifcally, we see a statistically significant reduction in Brier score using the GEV compared to logit for settings one and two and compared to probit for setting two.
% However, in the other settings, the logit and probit methods tend to perform better than the GEV method.

% The results using AUC are much less conclusive with only settings one and four demonstrating significant differences between the methods at $\alpha = 0.05$.
% As with the Brier scores, the GEV method shows a statistically significant increase in AUC over the logit method for setting one, and for setting four, the both the probit and logit methods show a statistically significant improvement in AUC over the GEV method.

% \fref{rbfig:post-med-2} and \fref{rbfig:post-med-3} show the posterior median of $P(Y =1)$ for settings 2 and 3 respectively of a simulated dataset.
% As you can see on the figures, the both the spatial probit and logistic models oversmooth $P(Y = 1)$, whereas the spatial GEV method is able to capture small pockets of spatial dependence.
% Plots for the medians of settings 1 and 4 look similar, so they are not included here.

% \begin{figure}
%   % this figure comes from markdown/sim-hmc/predict-maps.R
%   \includegraphics[width=\linewidth]{plots/post-med-2.pdf}
%   \caption{Posterior median $P(Y = 1)$ for spatial GEV, probit, and logistic regression for setting 2.}
%   \label{rbfig:post-med-2}
% \end{figure}

% \begin{figure}
%   % this figure comes from markdown/sim-hmc/predict-maps.R
%   \includegraphics[width=\linewidth]{plots/post-med-3.pdf}
%   \caption{Posterior median $P(Y = 1)$ for spatial GEV, probit, and logistic regression for setting 3.}
%   \label{rbfig:post-med-3}
% \end{figure}

% If needed, species 2 is \emph{Hedysarum scoparium} , and \emph{Hedysarum scoparium} can be found in $0.54\%$ of the grid cells.

\section{Data analysis}\label{rbs:dataanalysis}
\hl{Needs updating}

We compare our method to the spatial probit and logit for mapping the probability of the occurrence of \emph{Tamarix ramosissima}, a plant species, for a 1-km$^2$ study region of PR China \citep{Smith2012}.
The Chinese Academy of Forestry conducted a full census of the area, and the true occupancy of the species are plotted in \fref{rbfig:occupancy}.
\begin{figure}
  \centering
  \includegraphics[width=0.5\linewidth, trim=0 10em 0 10em]{plots/tamarix-census.pdf}
  \caption{True occupancy of \emph{Tamarix ramosissima} from a 1-km$^2$ study region of PR China.}
  \label{rbfig:occupancy}
\end{figure}
The region is split into $10$-m $\times$ $10$-m grid cells, and \emph{Tamarix ramosissima} can be found in approximately $6\%$ of the grid cells.

\subsection{Methods} \label{rbs:datamethods}
For the data analysis, we generate 100 subsamples using the CLU and SRS sampling methods with $n_s = 100$ and $n_s = 250$ initial locations.
For each subsample, we fit the spatial GEV, spatial probit, and spatial logistic models.
Knot placement, prior distributions, and MCMC details for the data analysis are the same as the simulation study.
To compare models, we use similar metrics as in the simulation study, but we average the metrics over subsamples.

\subsection{Results}\label{rbs:dataresults}

\begin{figure}
  % code/analysis/swd/combine-tables.R
  \includegraphics[width=\linewidth]{plots/data-perf-species1}
  \caption{Vertically averaged ROC curves for \emph{Tamarix ramosissima}.}
  \label{rbfig:simrocgev}
\end{figure}

\begin{table}
  \caption{Brier scores ($\times 100$) [SE] and AUROC [SE] for GEV, Probit, and Logistic methods for \emph{Tamarix ramosissima}.}
  \label{rbtbl:simbsresults}
  \centering
  \footnotesize
  \begin{tabular}{cclllclll}
  \toprule
    \multicolumn{2}{c}{ }& \multicolumn{3}{c}{BS} & \phantom{abc} & \multicolumn{3}{c}{AUROC}\\
    \cmidrule{3-5} \cmidrule{7-9}
    \multicolumn{1}{c}{$n$} & \multicolumn{1}{c}{Sample Type} & GEV    & Probit & Logistic & \phantom{abc} & GEV    & Probit & Logistic \\
  \midrule
  100 & CLU & 5.15 [0.05] & 5.08 [0.04] & 5.35 [0.02] && 0.747 [0.009] & 0.742
      [0.010] & 0.701 [0.009]\\
      & SRS & 5.03 [0.04] & 4.97 [0.04] & 5.51 [0.02] && 0.796 [0.006] & 0.802
      [0.006] & 0.631 [0.008]\\
  250 & CLU & 4.78 [0.04] & 4.68 [0.03] & 4.97 [0.04] && 0.773 [0.009] & 0.784
      [0.009] & 0.790 [0.008]\\
      & SRS & 4.83 [0.04] & 4.75 [0.03] & 5.17 [0.05] && 0.826 [0.007] & 0.848
      [0.005] & 0.712 [0.013]\\
  \bottomrule
  \end{tabular}
\end{table}

\section{Conclusions}\label{rbs:conclusions}